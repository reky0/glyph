name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    name: Build and vet
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: "1.24"

      - name: Download dependencies
        run: |
          for mod in libs/glyph-core libs/glyph-ink libs/glyph-store libs/glyph-mind \
                     tools/pin tools/ask tools/diff tools/stand; do
            echo "==> $mod"
            (cd "$mod" && go mod download)
          done

      - name: Build all tools
        run: |
          go build ./tools/pin/...
          go build ./tools/ask/...
          go build ./tools/diff/...
          go build ./tools/stand/...

      - name: Vet all modules
        run: |
          for mod in libs/glyph-core libs/glyph-ink libs/glyph-store libs/glyph-mind \
                     tools/pin tools/ask tools/diff tools/stand; do
            echo "==> $mod"
            (cd "$mod" && go vet ./...)
          done
